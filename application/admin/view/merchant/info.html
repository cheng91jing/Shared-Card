{extend name="../../common/view/layout_base"}
{block name="back"}
<div class="row border-bottom white-bg dashboard-header">
    <a class="btn btn-warning" title="上一页" href="javascript:void(0)" type="button" onclick="window.history.back()">
        <i class="fa fa-hand-point-left"></i>&nbsp;上一页
    </a>
</div>
{/block}
{block name="main"}
<div class="row">
    <div class="col-sm-6">
        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <h5>商家信息 <span class="text-warning">【{$partner.mobile ? '修改' : '新增'}】</span></h5>
            </div>
            <div class="ibox-content">
                <form class="form-horizontal" id="partner-form">
                    <input type="hidden" name="partner_id" id="partner_id" value="{$partner.id ?? ''}">
                    <div class="form-group">
                        <label class="col-sm-2 control-label" for="admin_mobile">所属管理员</label>
                        <div class="col-sm-6">
                            <div class="input-group">
                                <input class="form-control" name="admin_mobile" id="admin_mobile"
                                       rangelength="[11,11]"
                                       placeholder="请输入管理员手机号">
                                <span class="input-group-btn">
                                    <button class="btn btn-primary" type="button" id="search_admin">查询</button>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label" for="partner_type">类型</label>
                        <div class="col-sm-6">
                            <select class="form-control" name="partner_type" id="partner_type">
                                <option value="">请选择类型</option>
                                <option value="1">自营</option>
                                <option value="2">个人</option>
                                <option value="3">企业</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label" for="partner_cat">分类</label>
                        <div class="col-sm-6">
                            <select class="form-control" name="partner_cat" id="partner_cat">
                                <option value="">请选择分类</option>
                                <option value="1">酒店</option>
                                <option value="2">车行</option>
                                <option value="3">饭店</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label" for="partner_name">商家名称</label>
                        <div class="col-sm-6">
                            <input class="form-control" name="partner_name" id="partner_name" placeholder="请输入商家名称" rangelength="[2,20]" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-6">
                            <button type="submit" class="btn btn-outline btn-success dim" id="confirm_submit">确认提交
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="col-sm-3 animated" id="admin-info">
        <div class="panel panel-warning">
            <div class="panel-heading">管理员信息</div>
            <div class="panel-body">
                <form class="form-horizontal">
                    <div class="form-group" style="margin-bottom: 0">
                        <label class="col-sm-4 control-label">手机号</label>
                        <div class="col-sm-8">
                            <p class="form-control-static" id="admin-info-mobile"></p>
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 0">
                        <label class="col-sm-4 control-label">用户名</label>
                        <div class="col-sm-8">
                            <p class="form-control-static" id="admin-info-username"></p>
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 0">
                        <label class="col-sm-4 control-label">角色</label>
                        <div class="col-sm-8">
                            <p class="form-control-static" id="admin-info-role"></p>
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 0">
                        <label class="col-sm-4 control-label">商家</label>
                        <div class="col-sm-8">
                            <p class="form-control-static" id="admin-info-merchant"></p>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{/block}
{block name="footer_resource"}
<script src="__STATIC__/plugins/validate/jquery.validate.min.js"></script>
<script src="__STATIC__/plugins/validate/messages_zh.min.js"></script>
{/block}
{block name="footer_js"}
<script>
    $.validator.setDefaults({
        highlight: function (e) {
            $(e).closest(".form-group").removeClass("has-success").addClass("has-error")
        }, success: function (e) {
            e.closest(".form-group").removeClass("has-error").addClass("has-success")
        }, errorElement: "span", errorPlacement: function (e, r) {
            // e.appendTo(r.is(":radio") || r.is(":checkbox") ? r.parent().parent().parent() : r.parent())
            if (r.is(":radio") || r.is(":checkbox")) {
                e.appendTo(r.parent().parent().parent())
            } else if (r.parent().hasClass('input-group')) {
                e.appendTo(r.parent().parent())
            } else {
                e.appendTo(r.parent())
            }
        }/*, errorClass: "help-block m-b-none", validClass: "help-block m-b-none"*/
    });
    $("#search_admin").click(function (e) {
        $("#admin-info").removeClass("fadeInRight").addClass("fadeOutRight");
        $.post('__ROOT__/admin/merchant/search', {admin_mobile: $.trim($("#admin_mobile").val())}, function (res) {
            if (res.error_code) {
                swal({
                    type: 'error',
                    title: res.error_message,
                    allowOutsideClick: false
                })
                return false;
            }
            $("#admin-info-mobile").html(res.data.mobile);
            $("#admin-info-username").html(res.data.username);
            $("#admin-info").removeClass("fadeOutRight").addClass("fadeInRight");
        }, 'json')
    });
    $('#partner-form').validate({
        submitHandler: function (form) {
            $.post('__ROOT__/admin/merchant/add', $(form).serialize(), function (res) {
                if (res.error_code) {
                    swal({
                        type: 'error',
                        title: '出错了',
                        text: res.error_message,
                        allowOutsideClick: false
                    })
                } else {
                    swal({
                        type: 'success',
                        title: '添加成功',
                        timer: 3000,
                        allowOutsideClick: false
                    }).then(result => {
                        window.location.href = '__ROOT__/admin/merchant'
                    })
                }
            }, 'json')
        },
        // errorPlacement:function(error, element) {
        //     if(element.parent().hasClass('input-group')){
        //         error.appendTo(element.parent().parent());
        //     }else{
        //         error.appendTo(element.parent());
        //     }
        // }
    });
</script>
{/block}
