{extend name="../../common/view/layout_base"}
{block name="back"}
<div class="row border-bottom white-bg dashboard-header">
    <a class="btn btn-warning" title="上一页" href="javascript:void(0)" type="button" onclick="window.history.back()">
        <i class="fa fa-hand-point-left"></i>&nbsp;上一页
    </a>
</div>
{/block}
{block name="main"}
<div class="row">
    <div class="col-sm-6">
        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <h5>用户信息 <span class="text-warning">【{$user.mobile ? '修改' : '新增'}】</span></h5>
            </div>
            <div class="ibox-content">
                <form class="form-horizontal" id="user-form">
                    <input type="hidden" name="user_id" id="user_id" value="{$user.id ?? ''}">
                    <div class="form-group">
                        <label class="col-sm-2 control-label" for="mobile">手机号</label>
                        <div class="col-sm-6">
                            <input class="form-control" id="mobile" name="mobile" value="{$user.mobile ?? ''}"
                                   placeholder="请填写手机号" type="text" rangelength="[11,11]" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label" for="new_password">设置密码</label>
                        <div class="col-sm-6">
                            <input class="form-control" id="new_password" name="new_password" value=""
                                   placeholder="请输入新密码" type="password" rangelength="[6,20]" {$user.mobile ? '' :
                            'required'}>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label" for="confirm_password">确认密码</label>
                        <div class="col-sm-6">
                            <input class="form-control" id="confirm_password" name="confirm_password" value=""
                                   placeholder="请重复上面的输入密码" type="password" equalTo="#new_password" rangelength="[6,20]">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-6">
                            <button type="submit" class="btn btn-outline btn-success dim" id="confirm_submit">确认提交
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{/block}
{block name="footer_resource"}
<script src="__STATIC__/plugins/validate/jquery.validate.min.js"></script>
<script src="__STATIC__/plugins/validate/messages_zh.min.js"></script>
{/block}
{block name="footer_js"}
<script>
    $.validator.setDefaults({
        highlight: function (e) {
            $(e).closest(".form-group").removeClass("has-success").addClass("has-error")
        }, success: function (e) {
            e.closest(".form-group").removeClass("has-error").addClass("has-success")
        }, errorElement: "span", errorPlacement: function (e, r) {
            e.appendTo(r.is(":radio") || r.is(":checkbox") ? r.parent().parent().parent() : r.parent())
        }/*, errorClass: "help-block m-b-none", validClass: "help-block m-b-none"*/
    });
    $('#user-form').validate({
        submitHandler: function (form) {
            $.post('__ROOT__/admin/member/add', $(form).serialize(), function (res) {
                if(res.error_code){
                    swal({
                        type: 'error',
                        title: '出错了',
                        text: res.error_message,
                        allowOutsideClick: false
                    })
                } else {
                    swal({
                        type: 'success',
                        title: '添加成功',
                        timer: 3000,
                        allowOutsideClick: false
                    }).then(result => {
                        window.location.href = '__ROOT__/admin/member'
                    })
                }
            }, 'json')
        },
        // errorPlacement:function(error, element) {
        //     if(element.parent().hasClass('input-group')){
        //         error.appendTo(element.parent().parent());
        //     }else{
        //         error.appendTo(element.parent());
        //     }
        // }
    });
</script>
{/block}
